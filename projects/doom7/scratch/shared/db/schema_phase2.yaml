# Phase 2: Runtime World Schema
# This phase extends the Phase 1 data model to support runtime, dynamic worlds.
# - worlds: template definitions for runtime worlds
# - runtime_worlds: live instances of worlds currently running
# - runtime_world_entities: mapping of spawned entities (by id) into a running world with position/rotation
version: 2
entities:
  # Worlds table defines all possible world templates that can be instantiated at runtime
  - name: worlds
    columns:
      - name: id
        type: integer
        primary_key: true
        auto_increment: true
      - name: name
        type: string
        not_null: true
        unique: true
      - name: map_reference
        type: string
      - name: created_at
        type: string
        not_null: true

  # Runtime worlds are live instances created when a world is loaded for play
  - name: runtime_worlds
    columns:
      - name: id
        type: integer
        primary_key: true
        auto_increment: true
      - name: world_id
        type: integer
        not_null: true
        foreign_key:
          table: worlds
          column: id
      - name: status
        type: string
      - name: started_at
        type: string
      - name: ended_at
        type: string

  # Runtime world entities map real entities into a running world with position and orientation
  - name: runtime_world_entities
    columns:
      - name: id
        type: integer
        primary_key: true
        auto_increment: true
      - name: world_id
        type: integer
        not_null: true
        foreign_key:
          table: runtime_worlds
          column: id
      - name: entity_id
        type: integer
        not_null: true
        foreign_key:
          table: entities
          column: id
      - name: pos_x
        type: real
      - name: pos_y
        type: real
      - name: rotation
        type: real
  
  - name: runtime_levels
    columns:
      - name: id
        type: integer
        primary_key: true
        auto_increment: true
      - name: level_id
        type: integer
        not_null: true
        foreign_key:
          table: levels
          column: id
      - name: world_id
        type: integer
        foreign_key:
          table: worlds
          column: id
      - name: status
        type: string
      - name: started_at
        type: string
      - name: ended_at
        type: string

  - name: runtime_entities
    columns:
      - name: id
        type: integer
        primary_key: true
        auto_increment: true
      - name: runtime_level_id
        type: integer
        not_null: true
        foreign_key:
          table: runtime_levels
          column: id
      - name: entity_id
        type: integer
        not_null: true
        foreign_key:
          table: entities
          column: id
      - name: pos_x
        type: real
      - name: pos_y
        type: real
      - name: rotation
        type: real
